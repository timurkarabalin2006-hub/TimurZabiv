<template>
  <div class="flex flex-col min-h-screen bg-gradient-to-br from-[#0b1524] via-[#0e2239] to-[#143d63] text-white px-6">
    <header class="fixed top-0 left-0 w-full flex justify-between items-center px-6 py-4 z-50 bg-transparent">
      
      <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –õ–æ–≥–æ—Ç–∏–ø -->
      <NuxtLink to="/" class="flex items-center gap-3 cursor-pointer group">
        <div class="text-2xl">üåä</div>
        <span class="font-bold text-xl sm:text-2xl drop-shadow-lg bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">
        </span>
      </NuxtLink>

      <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–æ–≤ –∏ –±—É—Ä–≥–µ—Ä -->
      <div class="flex items-center gap-4">
        <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <div class="flex items-center gap-2 mr-2">
          <NuxtLink 
            to="/reports"
            class="bg-orange-500/20 hover:bg-orange-500/30 border border-orange-500/30 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 hover:scale-105 flex items-center gap-2"
          >
            <span>üìù</span>
            <span class="hidden sm:inline">{{ t('nav.reports') }}</span>
          </NuxtLink>
          
          <NuxtLink 
            to="/support"
            class="bg-green-500/20 hover:bg-green-500/30 border border-green-500/30 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 hover:scale-105 flex items-center gap-2"
          >
            <span>üõü</span>
            <span class="hidden sm:inline">{{ t('nav.support') }}</span>
          </NuxtLink>
          
          <NuxtLink 
            to="/contacts"
            class="bg-purple-500/20 hover:bg-purple-500/30 border border-purple-500/30 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300 hover:scale-105 flex items-center gap-2"
          >
            <span>üìû</span>
            <span class="hidden sm:inline">{{ t('nav.contacts') }}</span>
          </NuxtLink>
        </div>

        <!-- –ë—É—Ä–≥–µ—Ä –º–µ–Ω—é -->
        <button @click="toggleMenu" class="relative w-10 h-10 flex flex-col items-center justify-center group focus:outline-none">
          <div class="flex flex-col items-end gap-1.5">
            <span 
              class="block h-0.5 bg-white rounded-full transition-all duration-300 ease-out"
              :class="menuOpen ? 'w-6 translate-y-2 rotate-45' : 'w-6 group-hover:w-8'"
            ></span>
            <span 
              class="block h-0.5 bg-white rounded-full transition-all duration-300 ease-out"
              :class="menuOpen ? 'w-6 opacity-0' : 'w-4 group-hover:w-6'"
            ></span>
            <span 
              class="block h-0.5 bg-white rounded-full transition-all duration-300 ease-out"
              :class="menuOpen ? 'w-6 -translate-y-2 -rotate-45' : 'w-5 group-hover:w-7'"
            ></span>
          </div>
          
          <!-- –≠—Ñ—Ñ–µ–∫—Ç –ø—É–ª—å—Å–∞—Ü–∏–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ -->
          <div class="absolute inset-0 rounded-full bg-white/0 group-hover:bg-white/10 transition-all duration-300 -z-10" 
               :class="menuOpen ? 'scale-150 bg-white/20' : ''"></div>
        </button>
      </div>

      <!-- –ö—Ä–∞—Å–∏–≤–æ–µ –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é -->
      <Transition name="menu">
        <div v-if="menuOpen" 
             class="absolute top-full right-0 w-72 bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl flex flex-col p-4 gap-2 mt-2">
          
          <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ–Ω—é -->
          <div class="px-3 py-2 border-b border-white/10">
            <h3 class="text-sm font-semibold text-gray-300 uppercase tracking-wide">{{ t('menu.quickNav') }}</h3>
          </div>
          
          <!-- –ü—É–Ω–∫—Ç—ã –º–µ–Ω—é -->
          <NuxtLink 
            to="/temperature" 
            class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 transition-all duration-200 group"
            @click="closeMenu"
          >
            <div class="w-8 h-8 bg-yellow-500/20 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
              <span class="text-lg">üå°Ô∏è</span>
            </div>
            <div>
              <div class="font-medium text-white">{{ t('menu.temperature') }}</div>
              <div class="text-xs text-gray-400">{{ t('menu.tempDesc') }}</div>
            </div>
          </NuxtLink>

          <NuxtLink 
            to="/water" 
            class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 transition-all duration-200 group"
            @click="closeMenu"
          >
            <div class="w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
              <span class="text-lg">üíß</span>
            </div>
            <div>
              <div class="font-medium text-white">{{ t('menu.waterLevel') }}</div>
              <div class="text-xs text-gray-400">{{ t('menu.waterDesc') }}</div>
            </div>
          </NuxtLink>

          <NuxtLink 
            to="/map" 
            class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 transition-all duration-200 group"
            @click="closeMenu"
          >
            <div class="w-8 h-8 bg-cyan-500/20 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
              <span class="text-lg">üó∫Ô∏è</span>
            </div>
            <div>
              <div class="font-medium text-white">{{ t('menu.map') }}</div>
              <div class="text-xs text-gray-400">{{ t('menu.mapDesc') }}</div>
            </div>
          </NuxtLink>

          <NuxtLink 
            to="/polution" 
            class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 transition-all duration-200 group"
            @click="closeMenu"
          >
            <div class="w-8 h-8 bg-purple-500/20 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
              <span class="text-lg">ü¶†</span>
            </div>
            <div>
              <div class="font-medium text-white">{{ t('menu.pathogen') }}</div>
              <div class="text-xs text-gray-400">{{ t('menu.pathogenDesc') }}</div>
            </div>
          </NuxtLink>

          <NuxtLink 
            to="/transparency" 
            class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 transition-all duration-200 group"
            @click="closeMenu"
          >
            <div class="w-8 h-8 bg-green-500/20 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
              <span class="text-lg">üîç</span>
            </div>
            <div>
              <div class="font-medium text-white">{{ t('menu.transparency') }}</div>
              <div class="text-xs text-gray-400">{{ t('menu.transparencyDesc') }}</div>
            </div>
          </NuxtLink>

          <NuxtLink 
            to="/conductivity" 
            class="flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/10 transition-all duration-200 group"
            @click="closeMenu"
          >
            <div class="w-8 h-8 bg-red-500/20 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
              <span class="text-lg">‚ö°</span>
            </div>
            <div>
              <div class="font-medium text-white">{{ t('menu.conductivity') }}</div>
              <div class="text-xs text-gray-400">{{ t('menu.conductivityDesc') }}</div>
            </div>
          </NuxtLink>

          <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
          <div class="border-t border-white/10 my-2"></div>

          <!-- –î–æ–º–∞—à–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
          <NuxtLink 
            to="/" 
            class="flex items-center gap-3 px-4 py-3 rounded-xl bg-blue-500/20 hover:bg-blue-500/30 transition-all duration-200 group"
            @click="closeMenu"
          >
            <div class="w-8 h-8 bg-blue-500/30 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
              <span class="text-lg">üè†</span>
            </div>
            <div>
              <div class="font-medium text-white">{{ t('menu.home') }}</div>
              <div class="text-xs text-blue-300">{{ t('menu.homeDesc') }}</div>
            </div>
          </NuxtLink>
        </div>
      </Transition>
    </header>

    <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü -->
    <main class="flex-1 pt-24">
      <slot />
    </main>
  </div>
</template>

<script setup>
import { ref } from 'vue'

// –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–Ω—é
const menuOpen = ref(false)
const showLanguageMenu = ref(false)

// –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —è–∑—ã–∫–∞
const currentLang = ref('en')

// –î–æ—Å—Ç—É–ø–Ω—ã–µ —è–∑—ã–∫–∏
const availableLanguages = [
  { code: 'en', name: 'English', flag: 'üá∫üá∏' },
  { code: 'ru', name: '–†—É—Å—Å–∫–∏–π', flag: 'üá∑üá∫' },
  { code: 'kk', name: '“ö–∞–∑–∞“õ—à–∞', flag: 'üá∞üáø' },
  { code: 'es', name: 'Espa√±ol', flag: 'üá™üá∏' }
]

// –ü–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –º–µ–Ω—é
const translations = {
  en: {
    nav: {
      reports: 'Reports',
      support: 'Support',
      contacts: 'Contacts'
    },
    menu: {
      quickNav: 'Quick Navigation',
      temperature: 'Temperature',
      tempDesc: 'Thermal monitoring',
      waterLevel: 'Water Level',
      waterDesc: 'Depth variations',
      map: 'Interactive Map',
      mapDesc: 'Explore regions',
      pathogen: 'Pathogen Risk',
      pathogenDesc: 'Bio safety',
      transparency: 'Transparency',
      transparencyDesc: 'Water clarity',
      conductivity: 'Conductivity',
      conductivityDesc: 'Mineral activity',
      home: 'Dashboard Home',
      homeDesc: 'Back to main'
    }
  },
  ru: {
    nav: {
      reports: '–û—Ç—á—ë—Ç—ã',
      support: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞',
      contacts: '–ö–æ–Ω—Ç–∞–∫—Ç—ã'
    },
    menu: {
      quickNav: '–ë—ã—Å—Ç—Ä–∞—è –ù–∞–≤–∏–≥–∞—Ü–∏—è',
      temperature: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞',
      tempDesc: '–¢–µ–ø–ª–æ–≤–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥',
      waterLevel: '–£—Ä–æ–≤–µ–Ω—å –í–æ–¥—ã',
      waterDesc: '–ò–∑–º–µ–Ω–µ–Ω–∏—è –≥–ª—É–±–∏–Ω—ã',
      map: '–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –ö–∞—Ä—Ç–∞',
      mapDesc: '–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å —Ä–µ–≥–∏–æ–Ω—ã',
      pathogen: '–†–∏—Å–∫ –ü–∞—Ç–æ–≥–µ–Ω–æ–≤',
      pathogenDesc: '–ë–∏–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å',
      transparency: '–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å',
      transparencyDesc: '–ß–∏—Å—Ç–æ—Ç–∞ –≤–æ–¥—ã',
      conductivity: '–≠–ª–µ–∫—Ç—Ä–æ–ø—Ä–æ–≤–æ–¥–Ω–æ—Å—Ç—å',
      conductivityDesc: '–ú–∏–Ω–µ—Ä–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å',
      home: '–ì–ª–∞–≤–Ω–∞—è –ü–∞–Ω–µ–ª—å',
      homeDesc: '–ù–∞ –≥–ª–∞–≤–Ω—É—é'
    }
  },
  kk: {
    nav: {
      reports: '–ï—Å–µ–ø—Ç–µ—Ä',
      support: '“ö–æ–ª–¥–∞—É',
      contacts: '–ë–∞–π–ª–∞–Ω—ã—Å'
    },
    menu: {
      quickNav: '–ñ—ã–ª–¥–∞–º –ù–∞–≤–∏–≥–∞—Ü–∏—è',
      temperature: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞',
      tempDesc: '–ñ—ã–ª—É–ª—ã“õ –±–∞“õ—ã–ª–∞—É',
      waterLevel: '–°—É –î–µ“£–≥–µ–π—ñ',
      waterDesc: '–¢–µ—Ä–µ“£–¥—ñ–∫ ”©–∑–≥–µ—Ä—ñ—Å—Ç–µ—Ä—ñ',
      map: '–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤—Ç—ñ –ö–∞—Ä—Ç–∞',
      mapDesc: '–ê–π–º–∞“õ—Ç–∞—Ä–¥—ã –∑–µ—Ä—Ç—Ç–µ—É',
      pathogen: '–ü–∞—Ç–æ–≥–µ–Ω–¥—ñ–∫ –¢”ô—É–µ–∫–µ–ª',
      pathogenDesc: '–ë–∏–æ“õ–∞—É—ñ–ø—Å—ñ–∑–¥—ñ–∫',
      transparency: '–ú”©–ª–¥—ñ—Ä–ª—ñ–∫',
      transparencyDesc: '–°—É —Ç–∞–∑–∞–ª—ã“ì—ã',
      conductivity: '–≠–ª–µ–∫—Ç—Ä ”©—Ç–∫—ñ–∑–≥—ñ—à—Ç—ñ–∫',
      conductivityDesc: '–ú–∏–Ω–µ—Ä–∞–ª–¥—ã“õ –±–µ–ª—Å–µ–Ω–¥—ñ–ª—ñ–∫',
      home: '–ë–∞—Å—Ç—ã –ü–∞–Ω–µ–ª—å',
      homeDesc: '–ë–∞—Å—Ç—ã –±–µ—Ç–∫–µ'
    }
  },
  es: {
    nav: {
      reports: 'Reportes',
      support: 'Soporte',
      contacts: 'Contactos'
    },
    menu: {
      quickNav: 'Navegaci√≥n R√°pida',
      temperature: 'Temperatura',
      tempDesc: 'Monitoreo t√©rmico',
      waterLevel: 'Nivel del Agua',
      waterDesc: 'Variaciones de profundidad',
      map: 'Mapa Interactivo',
      mapDesc: 'Explorar regiones',
      pathogen: 'Riesgo de Pat√≥genos',
      pathogenDesc: 'Bioseguridad',
      transparency: 'Transparencia',
      transparencyDesc: 'Claridad del agua',
      conductivity: 'Conductividad',
      conductivityDesc: 'Actividad mineral',
      home: 'Panel Principal',
      homeDesc: 'Volver al inicio'
    }
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞
const t = (key) => {
  const keys = key.split('.')
  let value = translations[currentLang.value]
  
  for (const k of keys) {
    value = value?.[k]
  }
  
  return value || key
}

// –§—É–Ω–∫—Ü–∏–∏ –º–µ–Ω—é
function toggleMenu() {
  menuOpen.value = !menuOpen.value
  showLanguageMenu.value = false
}

function closeMenu() {
  menuOpen.value = false
}

// –§—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞
const changeLanguage = (lang) => {
  currentLang.value = lang
  showLanguageMenu.value = false
  localStorage.setItem('preferred-language', lang)
}

const getLanguageFlag = (lang) => {
  const language = availableLanguages.find(l => l.code === lang)
  return language ? language.flag : 'üåê'
}

const toggleLanguageMenu = () => {
  showLanguageMenu.value = !showLanguageMenu.value
  menuOpen.value = false
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ –æ–±–ª–∞—Å—Ç–∏
const closeOnClickOutside = (event) => {
  if ((menuOpen.value || showLanguageMenu.value) && !event.target.closest('header')) {
    closeMenu()
    showLanguageMenu.value = false
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
onMounted(() => {
  const savedLang = localStorage.getItem('preferred-language')
  if (savedLang && availableLanguages.some(lang => lang.code === savedLang)) {
    currentLang.value = savedLang
  }
  
  document.addEventListener('click', closeOnClickOutside)
})

onUnmounted(() => {
  document.removeEventListener('click', closeOnClickOutside)
})
</script>

<style scoped>
/* –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –º–µ–Ω—é */
.menu-enter-active,
.menu-leave-active {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.menu-enter-from {
  opacity: 0;
  transform: translateY(-10px) scale(0.95);
}

.menu-leave-to {
  opacity: 0;
  transform: translateY(-10px) scale(0.95);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ */
.router-link-active {
  background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(6, 182, 212, 0.2));
  border: 1px solid rgba(59, 130, 246, 0.3);
}
</style>